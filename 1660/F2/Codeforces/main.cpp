//
//  main.cpp
//  Codeforces
//
//  Created by loyinglin.
//  Copyright loyinglin. All rights reserved.

/************************** é¢˜è§£ **********************
 [é¢˜ç›®é“¾æ¥](https://codeforces.com/contest/1660/problem/F1)
 **é¢˜ç›®å¤§æ„ï¼š**
 ç»™å‡ºç”±+å’Œ-ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ç§°å­—ç¬¦ä¸²ä¸ºå¹³è¡¡çš„å­—ç¬¦ä¸²ï¼Œå‡å¦‚+å’Œ-çš„å­—ç¬¦æ˜¯ç›¸åŒçš„ï¼›
 ç°åœ¨å¯ä»¥å¯¹å­—ç¬¦ä¸²æ‰§è¡Œæ“ä½œï¼Œæ¯æ¬¡å°†ä¸¤ä¸ªç›¸é‚»çš„-å·åˆå¹¶ä¸º+å·ï¼›å‡å¦‚è‹¥å¹²æ¬¡æ“ä½œä¹‹åï¼Œå­—ç¬¦ä¸²å˜æˆäº†å¹³è¡¡çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥ç§°ä¹‹ä¸ºç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼›
 
 ç°åœ¨ç»™å‡ºé•¿åº¦ä¸ºnçš„å­—ç¬¦ä¸²ï¼Œé—®å­—ç¬¦ä¸²ä¸­æœ‰å¤šå°‘å­ä¸²æ˜¯ç‰¹æ®Šçš„ï¼›
 
 
  **è¾“å…¥ï¼š**
 ç¬¬ä¸€è¡Œï¼Œæ•´æ•°ğ‘¡ è¡¨ç¤ºtä¸ªæ ·ä¾‹
 æ¯ä¸ªæ ·ä¾‹ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œæ˜¯æ•´æ•°ğ‘›
 ç¬¬äºŒè¡Œæ˜¯å­—ç¬¦ä¸²ï¼›
 
 **è¾“å‡ºï¼š**
è¾“å‡ºæ»¡è¶³è¦æ±‚çš„å­ä¸²æ•°é‡ï¼›
 
 **Examples**
 **input**
 
 **output**
 
 **é¢˜ç›®è§£æï¼š**
 è¿™æ˜¯hardéš¾åº¦ï¼Œé¢˜ç›®ç»™å‡ºæ¥çš„èŒƒå›´æ¯”è¾ƒå¤§ï¼ŒO(N\*N)çš„å¤æ‚åº¦æšä¸¾æ‰€æœ‰å­—ç¬¦ä¸²çš„å­ä¸²çš„æ–¹å¼å·²ç»ä¸é€‚ç”¨ï¼›
 é¦–å…ˆéœ€è¦å¯¹æˆ‘ä»¬å·²ç»é‡‡ç”¨çš„æ–¹æ³•è¿›è¡Œç®€åŒ–ï¼Œcountxå’Œcountyå…¶å®å¯ä»¥ç®€åŒ–ä¸ºcountx-countyçš„æ–¹å¼ï¼Œå¹¶ä¸”ç”±äºŒç»´ç®€åŒ–ä¸ºä¸€ç»´ï¼š
 æˆ‘ä»¬ç”¨sum[i]è¡¨ç¤ºå‰iä¸ªå­—ç¬¦ç›¸åŠ çš„ç»“æœï¼Œå­—ç¬¦+è¡¨ç¤º-1ï¼Œå­—ç¬¦-è¡¨ç¤º+1ï¼›
 é‚£ä¹ˆå­ä¸²[i, j]å¯ä»¥ç”¨sum[j] - sum[i - 1]çš„æ–¹å¼å¿«é€Ÿå¾—åˆ°ç»“æœï¼Œ(sum[j] - sum[i - 1])%3==0 && sum[j] >= sum[i - 1] è¡¨ç¤ºæœ‰è§£ï¼›
 
 ä»å·¦åˆ°å³éå†å­—ç¬¦ä¸²ï¼Œå¯¹äºç¬¬jä¸ªå­—ç¬¦ï¼Œé¦–å…ˆå¾—åˆ°sum[j]ï¼Œç„¶åéå†iâˆˆ[1, j-1]åˆ¤æ–­ (sum[j] - sum[i - 1])%3==0 && sum[j] >= sum[i - 1] çš„æ•°é‡ï¼›
 è¿™ä¸ªéå†è¿‡ç¨‹å­˜åœ¨è¾ƒå¤šé‡å¤è®¡ç®—ï¼Œæˆ‘ä»¬åªåœ¨ä¹iâˆˆ[1, j-1]è¿™ä¸ªåŒºé—´ä¸­sum[i]çš„å€¼ï¼Œè€Œå¯¹içš„ä½ç½®å¹¶ä¸å…³å¿ƒï¼Œå¹¶ä¸”sum[i]çš„å€¼æœ€å¤šä¹Ÿåªæœ‰2n+1ç§å¯èƒ½ï¼ˆå–å€¼èŒƒå›´æ˜¯[-n, n]ï¼‰ï¼›
 é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æŠŠsum[i]çš„ç»“æœç›´æ¥å­˜åˆ°[-n, n] è¿™ä¸ªåŒºé—´ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è·å–éå†è¿™ä¸ªåŒºé—´çš„å€¼å³å¯ã€‚
 ä»¥n=4ä¸ºä¾‹ï¼Œsum[i]çš„ç»“æœå¯èƒ½æœ‰[-4,-3,-2,-1,0,1,2,3,4]ï¼Œå¦‚æœsum[j]=3ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å–sum[i]=3/0/-3çš„å€¼ï¼›å¦‚æœsum[j]=2ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å–sum[i]=-1/-4çš„å€¼ï¼›
 ç”±äºæˆ‘ä»¬åªåœ¨ä¹%3çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ç”¨cnt[0,1,2]æ¥è¡¨ç¤ºsum[i]%3çš„å€¼å’Œï¼Œè¿™æ ·ä»æ•°ç»„ä¸­å–å€¼å°±ä¸éœ€è¦éå†ï¼Œå¯ä»¥å¾ˆå¿«å–åˆ°æŸä¸ªä½™æ•°çš„å€¼ï¼›
 
 ä½†æ˜¯è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ¡ä»¶æ˜¯sum[j] >= sum[i - 1]ï¼Œsum[j]=0çš„æ—¶å€™ï¼Œsum[i]=3è¿™ç§æƒ…å†µæ˜¯ä¸å…è®¸çš„ï¼Œæ‰€ä»¥cntçš„å€¼æ˜¯éœ€è¦ç»´æŠ¤çš„ï¼Œç»´æŠ¤æ–¹å¼å°±æ˜¯ï¼š
 å½“æˆ‘ä»¬sum[j]å˜å°çš„æ—¶å€™ï¼Œcntä½œä¸ºç´¯åŠ å’Œï¼Œè¦é€€æ‰ä¹‹å‰ç´¯åŠ çš„å€¼ï¼›
 æ¯”å¦‚è¯´sum[j]=2çš„æ—¶å€™ï¼Œcntç´¯åŠ äº†[-4, 2]çš„åŒºé—´ï¼›sum[j+1]=1çš„æ—¶å€™ï¼Œcntç´¯åŠ äº†[-4, 1]çš„åŒºé—´ï¼›ä¹Ÿå°±æ˜¯cntéœ€è¦é€€æ‰sum[j]=2çš„å€¼ï¼›
 
 ç”±äºsum[i]çš„å–å€¼èŒƒå›´æ˜¯[-n, n] æˆ‘ä»¬å¯ä»¥å°†sum[i]+nï¼Œè¿™æ ·å–å€¼èŒƒå›´å˜æˆ[0, 2n]ï¼Œå¥½å¤„æ˜¯å¯ä»¥ç”¨æ•°ç»„æ¥è¡¨ç¤ºï¼Œå¹¶ä¸”ä¸å½±å“æˆ‘ä»¬å¯¹ç»“æœçš„ç»“ç®—ï¼Œå› ä¸º (sum[j] - sum[i - 1])ç­‰äº (sum[j] + nï¼‰-ï¼ˆsum[i-1] + nï¼‰ï¼Œsum[j] >= sum[i-1] ç­‰äº sum[j] + n >= sum[i-1] + nï¼›
 
 
 **æ€è€ƒğŸ¤”ï¼š**

 
 ************************* é¢˜è§£ ***********************/
#include<cstdio>
#include<cmath>
#include<stack>
#include<map>
#include<set>
#include<queue>
#include<deque>
#include<string>
#include<utility>
#include<sstream>
#include<cstring>
#include<iostream>
#include<algorithm>
using namespace std;

typedef long long lld;

class Solution {
    static const int N = 200010;
    char str[N];
    int sum[N * 2];
    int cnt[3];

public:
    void solve() {
        int t;
        cin >> t;
        while (t--) {
            int n;
            cin >> n;
            cin >> (str + 1);
            lld ans = 0;
            int preCount = n;
            memset(cnt, 0, sizeof(cnt));
            memset(sum, 0, sizeof(sum));
            sum[preCount] = 1;
            cnt[preCount % 3] = 1;
            for (int i = 1; i <= n; ++i) {
                int curCount = preCount + (str[i] == '-' ? 1 : -1);
                int index = curCount % 3;
                if (curCount < preCount) {
                    cnt[preCount % 3] -= sum[preCount];
                }
                else {
                    cnt[curCount % 3] += sum[curCount];
                }
                ans += cnt[index % 3];
                cnt[curCount % 3]++;
                sum[curCount]++;
                preCount = curCount;
            }
            cout << ans << endl;
        }
    }
}
ac;

int main(int argc, const char * argv[]) {
    // insert code here...
    
    ac.solve();
    
    return 0;
}

/**
 */
